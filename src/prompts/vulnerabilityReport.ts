import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { z } from 'zod';

export function registerVulnerabilityReportPrompt(server: McpServer): void {
  server.prompt(
    'vulnerability-report',
    'Generate a professional vulnerability report',
    {
      findings: z.string().describe('Raw vulnerability findings to format into a report'),
      projectName: z.string().describe('Name of the project or application'),
      scope: z.string().optional().describe('Scope of the security assessment'),
      reportType: z.enum(['executive', 'technical', 'full']).default('full')
        .describe('Type of report to generate'),
    },
    ({ findings, projectName, scope, reportType }) => {
      const scopeText = scope ? `\n\n**Scope:** ${scope}` : '';

      let reportInstructions = '';
      switch (reportType) {
        case 'executive':
          reportInstructions = `Generate an executive summary report suitable for non-technical stakeholders:
- High-level risk overview
- Business impact assessment
- Key recommendations with priorities
- Resource requirements for remediation`;
          break;
        case 'technical':
          reportInstructions = `Generate a detailed technical report for developers and security engineers:
- Detailed vulnerability descriptions
- Step-by-step reproduction instructions
- Code-level remediation guidance
- Testing verification steps`;
          break;
        case 'full':
          reportInstructions = `Generate a comprehensive security assessment report including:
- Executive summary for leadership
- Technical details for engineering teams
- Remediation roadmap with priorities
- Appendices with supporting data`;
          break;
      }

      return {
        messages: [
          {
            role: 'user' as const,
            content: {
              type: 'text' as const,
              text: `Generate a professional vulnerability assessment report for **${projectName}**.${scopeText}

## Report Requirements

${reportInstructions}

## Report Structure

### 1. Cover Page Information
- Report title
- Project name
- Assessment date
- Confidentiality notice

### 2. Executive Summary
- Overall risk rating (Critical/High/Medium/Low)
- Key findings summary
- Immediate actions required
- Strategic recommendations

### 3. Methodology
- Assessment approach
- Tools used
- Scope and limitations

### 4. Findings Summary
- Vulnerability statistics by severity
- Risk distribution chart description
- Trend analysis if applicable

### 5. Detailed Findings
For each vulnerability:
- Title and severity rating
- CWE/CVE references
- Affected component
- Description
- Impact assessment
- Proof of concept (sanitized)
- Remediation steps
- References

### 6. Risk Rating Methodology
- Severity definitions
- Likelihood factors
- Impact factors
- Risk calculation

### 7. Remediation Roadmap
- Immediate actions (0-7 days)
- Short-term fixes (1-4 weeks)
- Long-term improvements (1-3 months)
- Resource estimates

### 8. Appendices
- Technical details
- Raw scan outputs
- Configuration recommendations

## Raw Findings to Process

${findings}`,
            },
          },
        ],
      };
    }
  );
}
